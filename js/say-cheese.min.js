var SayCheese=function(){var a;navigator.getUserMedia=navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.mozGetUserMedia||navigator.msGetUserMedia||!1,window.AudioContext=window.AudioContext||window.webkitAudioContext,window.URL=window.URL||window.webkitURL;var b={NOT_SUPPORTED:"NOT_SUPPORTED",AUDIO_NOT_SUPPORTED:"AUDIO_NOT_SUPPORTED"};return a=function(b,c){return this.snapshots=[],this.video=null,this.events={},this.stream=null,this.options={videoSource:null,snapshots:!0,audio:!1,width:320},this.setOptions(c),this.element=document.querySelector(b),this},a.prototype.on=function(b,c){this.events.hasOwnProperty(b)===!1&&(this.events[b]=[]),this.events[b].push(c)},a.prototype.off=function(b,c){this.events[b]=this.events[b].filter(function(a){return a!==c})},a.prototype.trigger=function(b,c){return this.events.hasOwnProperty(b)!==!1&&void this.events[b].forEach(function(a){a.call(this,c)}.bind(this))},a.prototype.setOptions=function(b){for(var c in b)this.options[c]=b[c]},a.prototype.getStreamUrl=function(){return window.URL&&window.URL.createObjectURL?window.URL.createObjectURL(this.stream):this.stream},a.prototype.createVideo=function(){var b=this.options.width,c=0,d=!1;this.video=document.createElement("video"),this.video.addEventListener("canplay",function(){if(!d)return c=this.video.videoHeight/(this.video.videoWidth/b),this.video.width=b,this.video.height=c,this.video.setAttribute("autoplay",""),d=!0,this.trigger("start")}.bind(this),!1)},a.prototype.linkAudio=function(){this.audioCtx=new window.AudioContext,this.audioStream=this.audioCtx.createMediaStreamSource(this.stream);var b=this.audioCtx.createBiquadFilter();this.audioStream.connect(b),b.connect(this.audioCtx.destination)},a.prototype.takeSnapshot=function(b,c){if(this.options.snapshots===!1)return!1;b=b||this.video.videoWidth,c=c||this.video.videoHeight;var d=document.createElement("canvas"),e=d.getContext("2d");d.width=b,d.height=c,e.drawImage(this.video,0,0,b,c),this.snapshots.push(d),this.trigger("snapshot",d),e=null},a.prototype.start=function(){if(navigator.getUserMedia===!1)return this.trigger("error",b.NOT_SUPPORTED),!1;var c=function(c){if(this.stream=c,this.createVideo(),navigator.mozGetUserMedia?this.video.mozSrcObject=c:this.video.src=this.getStreamUrl(),this.options.audio===!0)try{this.linkAudio()}catch(a){this.trigger("error",b.AUDIO_NOT_SUPPORTED)}this.element.appendChild(this.video),this.video.play(),this.trigger("success")}.bind(this),d=function a(a){this.trigger("error",a)}.bind(this);return navigator.getUserMedia({video:{optional:[{sourceId:this.options.videoSource}]},audio:this.options.audio},c,d)},a.prototype.stop=function(){return this.stream.stop(),window.URL&&window.URL.revokeObjectURL&&window.URL.revokeObjectURL(this.video.src),this.trigger("stop")},a}();